class selector{constructor(e){let t=this;t.opts=Object.assign({onHoverNode:function(e){},onOpen:function(e){},onClose:function(e){},onChange:function(e){},onToggleGroup:function(e){},enableSearch:!1,renewSearch:!0,caseSensitive:!1,matchingFunction:function(e,s){var o=e=>t.caseSensitive?e:e.toLowerCase();return o(e.substring(0,s.length))==o(s)},target:"",shorthandDescriptors:{option:"opt",group:"group",value:"v"}},e);let s=t.opts.shorthandDescriptors.option,o=t.opts.shorthandDescriptors.group;t.session=Math.random().toString(36).substring(2,15),t.target=e.target,t.opener=$(`<div class='custom_select_details' data-opener-for='${t.session}'>${t.target.html()}</div>`),t.opener.find(o).on("click",function(e){$(e.target).is(o)&&($(this).toggleClass("is_closed"),t.opts.onToggleGroup({target:this,wasClosed:$(this).is(".is_closed")}))}),$(document.body).append(t.opener),t.target.prop("id",t.session).on("click",function(e){t.toggle(e)}).find("*").remove().addBack().append(`<div class='value_inner' data-selector-for="${t.session}"></div>`),t.is_open=!1,t.selected=t.opener.find(`${0==t.opener.find("[selected]").length?s:"[selected]"}`).eq(0).addClass("active"),t.value=t.selected.attr("value")||t.selected.text(),t.change_to(t.selected.html()),t.all=t.opener.find(`${s}:not([disabled])`),t.all.on("click",function(e){t.change(e)}).on("mouseenter",function(e){t.focus_node($(e.target))}),t.last_key_search=["",0,t.selected],$(document.body).on("keydown",function(e){if(t.is_open){let o=`${s}:visible:not([disabled])`,n=e.key;if("ArrowDown"==n){let e=t.selected.nextAll(o).eq(0),n=0==e.length?t.opener.find(`${s}:first-of-type`):e;t.focus_node(n),t.scrollTo(n)}else if("ArrowUp"==n){let e=t.selected.prevAll(o).eq(0),n=0==e.length?t.opener.find(`${s}:last-of-type`):e;t.focus_node(n),t.scrollTo(n)}else if("Enter"==n)t.change({target:t.selected});else if(1==n.length||"Backspace"==n){let e=t.last_key_search;e[1]=e[0]==n&&e[2]==t.selected?e[1]+1:0,e[0]=t.opts.renewSearch?n:"Backspace"==n?e[0].substr(0,e[0].length-1):e[0]+n,!t.opts.renewSearch&&$(`.value_inner[data-selector-for="${t.session}"]`).attr("data-search-term",e[0]);let s=t.find(e[0],e[1]);s&&s[1]?(t.scrollTo($(s[1])),t.focus_node($(s[1])),e[2]=t.selected):t.opts.renewSearch&&(e[0]="")}else"Escape"==n&&t.toggle({target:t.selected})}})}find(e,t=0){let s=this.opener.find(this.opts.shorthandDescriptors.option),o=Object.values(s).map(e=>[e.innerText,e]).filter(t=>t[0]&&this.opts.matchingFunction(t[0],e));return s.removeClass("hidden_by_search"),0==this.opts.renewSearch&&s.not(o.map(e=>e[1])).addClass("hidden_by_search"),o[t]}focus_node(e){this.selected.removeClass("active"),e.addClass("active"),this.selected=e,this.opts.onHoverNode(e)}scrollTo(e){let t=this.opener.scrollTop(),s=e.position().top+t;(s>this.opener.innerHeight()||t>s)&&this.opener.animate({scrollTop:s},0)}position_on(){let e=this.target.offset(),t=e.top+this.target.outerHeight()+10,s=window.innerHeight,o=t+this.opener.height()>s?t-Math.abs(s-t-this.opener.height()-30):t,n=e.left;this.opener.css({display:"flex",top:s-e.top-this.opener.height()<0?t:o,left:n}),this.scrollTo(this.selected)}change(e){e.target=$(e.target),this.value=e.target.attr("value")||e.target.text(),this.change_to(e.target.html()),this.opts.onChange({node:e.target,event:e,value:this.value}),this.toggle(e)}change_to(e){this.target.find(".value_inner").html(e)}toggle(e){let t=this;t.is_open?(t.opener.hide(),t.target.removeClass("isOpen").addClass("isClosed"),t.opts.onClose(e.target)):(t.position_on(),t.target.removeClass("isClosed").addClass("isOpen"),t.opts.onOpen(e.target)),t.is_open=!t.is_open}}let minilect=new selector({target:$(".custom_select"),renewSearch:!1,enableSearch:!0});

class selector{constructor(e){let t=this;this.opts=Object.assign({onHoverNode:function(e){},onOpen:function(e){},onClose:function(e){},onChange:function(e){},enableSearch:!1,renewSearch:!0,caseSensitive:!1,matchingFunction:function(e,t){var s=e=>this.caseSensitive?e:e.toLowerCase();return s(e.substring(0,t.length))==s(t)},target:"",shorthandDescriptors:{option:"opt",group:"group",value:"v"}},e);let s=this.opts.shorthandDescriptors.option;this.session=Math.random().toString(36).substring(2,15),this.target=e.target,this.opener=$(`<div class='custom_select_details' data-opener-for='${this.session}'>${this.target.html()}</div>`),$(document.body).append(this.opener),this.target.prop("id",this.session).on("click",function(e){t.toggle(e)}).find("*").remove().addBack().append(`<div class='value_inner' data-selector-for="${this.session}"></div>`),this.is_open=!1,this.selected=this.opener.find(`${0==this.opener.find("[selected]").length?s:"[selected]"}`).eq(0).addClass("active"),this.value=this.selected.attr("value")||this.selected.text(),this.change_to(this.selected.html()),this.all=this.opener.find(`${s}:not([disabled])`),this.all.on("click",function(e){t.change(e)}).on("mouseenter",function(e){t.focus_node($(e.target))}),this.last_key_search=["",0,this.selected],$(document.body).on("keydown",function(e){if(t.is_open){let o=`${s}:visible:not([disabled])`;if("ArrowDown"==e.key){let e=t.selected.nextAll(o).eq(0),i=0==e.length?t.opener.find(`${s}:first-of-type`):e;t.focus_node(i),t.scrollTo(i)}else if("ArrowUp"==e.key){let e=t.selected.prevAll(o).eq(0),i=0==e.length?t.opener.find(`${s}:last-of-type`):e;t.focus_node(i),t.scrollTo(i)}else if("Enter"==e.key)t.change({target:t.selected});else if(1!=e.key.length&&"Backspace"!=e.key||!t.opts.enableSearch)"Escape"==e.key&&t.toggle({target:t.selected});else{let s=t.last_key_search;s[1]=s[0]==e.key&&s[2]==t.selected?s[1]+1:0,s[0]=t.opts.renewSearch?e.key:"Backspace"==e.key?s[0].substr(0,s[0].length-1):s[0]+e.key,!t.opts.renewSearch&&$(`.value_inner[data-selector-for="${t.session}"]`).attr("data-search-term",s[0]);let o=t.find(s[0],s[1]);o&&o[1]?(t.scrollTo($(o[1])),t.focus_node($(o[1])),s[2]=t.selected):t.opts.renewSearch&&(s[0]="")}}})}find(e,t=0){let s=this.opener.find(this.opts.shorthandDescriptors.option),o=Object.values(s).map(e=>[e.innerText,e]).filter(t=>t[0]&&this.opts.matchingFunction(t[0],e));return s.show(),0==this.opts.renewSearch&&s.not(o.map(e=>e[1])).hide(),o[t]}focus_node(e){this.selected.removeClass("active"),e.addClass("active"),this.selected=e,this.opts.onHoverNode(e)}scrollTo(e){let t=this.opener.scrollTop(),s=e.position().top+t;(s>this.opener.innerHeight()||t>s)&&this.opener.animate({scrollTop:s},100)}position_on(){let e=this.target.offset(),t=e.top+this.target.outerHeight()+10,s=window.innerHeight,o=t+this.opener.height()>s?t-Math.abs(s-t-this.opener.height()-30):t,i=e.left;this.opener.css({display:"flex",top:s-e.top-this.opener.height()<0?t:o,left:i}),this.scrollTo(this.selected)}change(e){e.target=$(e.target),this.value=e.target.attr("value")||e.target.text(),this.change_to(e.target.html()),this.opts.onChange({node:e.target,event:e,value:this.value}),this.toggle(e)}change_to(e){this.target.find(".value_inner").html(e)}toggle(e){this.is_open?(this.opener.hide(),this.target.removeClass("isOpen").addClass("isClosed"),this.opts.onClose(e.target)):(this.position_on(),this.target.removeClass("isClosed").addClass("isOpen"),this.opts.onOpen(e.target)),this.is_open=!this.is_open}}
